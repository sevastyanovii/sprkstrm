Logical Plan:
Aggregate [window#123-T10000ms, gender#72], [window#123-T10000ms AS window#115-T10000ms, gender#72, count(1) AS count#122L]
+- Filter ((timestamp#21-T10000ms >= window#123-T10000ms.start) AND (timestamp#21-T10000ms < window#123-T10000ms.end))
   +- Expand [ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(0 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(0 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(1 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(1 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(2 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(2 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(3 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(3 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(4 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(4 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(5 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(5 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(6 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(6 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(7 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(7 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(8 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(8 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72), ArrayBuffer(named_struct(start, precisetimestampconversion(((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(9 as bigint)) - cast(10 as bigint)) * 1000000) + 0), LongType, TimestampType), end, precisetimestampconversion((((((CASE WHEN (cast(CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) as double) = (cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) THEN (CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) + cast(1 as bigint)) ELSE CEIL((cast((precisetimestampconversion(timestamp#21-T10000ms, TimestampType, LongType) - 0) as double) / cast(1000000 as double))) END + cast(9 as bigint)) - cast(10 as bigint)) * 1000000) + 0) + 10000000), LongType, TimestampType)), timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72)], [window#123-T10000ms, timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72]
      +- Project [timestamp#21-T10000ms, userid#37, regionid#71, regionname#3, gender#72]
         +- Project [regionid#71, timestamp#21-T10000ms, pageid#36, userid#37, viewtime#38L, timestamp#55-T10000ms, userid#70, gender#72, regionname#3]
            +- Join LeftOuter, (regionid#71 = regionid#2)
               :- Join LeftOuter, ((userid#37 = userid#70) AND (timestamp#21-T10000ms >= timestamp#55-T10000ms))
               :  :- EventTimeWatermark timestamp#21: timestamp, 10 seconds
               :  :  +- Project [timestamp#21, val#33.pageid AS pageid#36, val#33.userid AS userid#37, val#33.viewtime AS viewtime#38L]
               :  :     +- Project [timestamp#21, from_json(StructField(pageid,StringType,true), StructField(userid,StringType,true), StructField(viewtime,LongType,false), val#30, Some(Europe/Moscow)) AS val#33]
               :  :        +- Project [timestamp#21, cast(value#17 as string) AS val#30]
               :  :           +- StreamingDataSourceV2Relation [key#16, value#17, topic#18, partition#19, offset#20L, timestamp#21, timestampType#22], org.apache.spark.sql.kafka010.KafkaSourceProvider$KafkaScan@3340d04, KafkaV2[Subscribe[pageviews]]
               :  +- EventTimeWatermark timestamp#55: timestamp, 10 seconds
               :     +- Project [timestamp#55, val#67.userid AS userid#70, val#67.regionid AS regionid#71, val#67.gender AS gender#72]
               :        +- Project [timestamp#55, from_json(StructField(userid,StringType,true), StructField(regionid,StringType,true), StructField(gender,StringType,true), val#64, Some(Europe/Moscow)) AS val#67]
               :           +- Project [timestamp#55, cast(value#51 as string) AS val#64]
               :              +- StreamingDataSourceV2Relation [key#50, value#51, topic#52, partition#53, offset#54L, timestamp#55, timestampType#56], org.apache.spark.sql.kafka010.KafkaSourceProvider$KafkaScan@23efc8bd, KafkaV2[Subscribe[users]]
               +- LocalRelation [regionid#2, regionname#3]